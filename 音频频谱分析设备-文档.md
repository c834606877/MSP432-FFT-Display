音频频谱分析设备
======

### 项目需求

1. 基于MSP432的在线频谱分析器。
2. 设备实时收集环境音频信息，在电脑上可以显示出实时的各频率分量，即FFT变换结果。
3. 音频收集器使用MSP432_MKEDUii板上的话筒收集。
4. 采集的信息可以动态切换环境音频的采样速率，通过设备按钮或者电脑进行切换。
5. 利用MCU进行信息提取分析。
6. 频谱的展示需要使用刻度标明， 并且刻度随着采样率的改变而改变。

### 需求分析

1. 项目分为两个MCU端和展示端：
   - MCU端负责对环境音频的收集，并进行FFT分析。
   - 展示端负责接收控制频谱信息并展示。
2. FFT计算使用CMSIS库函数。
3. 需要选择或设计一套简单可扩展的协议进行串口通信。
4. 考虑到原型设计，展示效果的要求，可使用Web或者本地客户端的方式进行开发。
5. 实时数据展示可以不使用数据库。

![示例图](http://www.html5wd.com/wp-content/uploads/2015/04/512.png)


### 异常情况

1. 无数据输入情况下应展示无数据输入。
2. 无法连接串口或串口连接中断时，应展示连接情况。

### 测试方法

1. 通过板载蜂鸣器发出指定频率声音，使MacrePhone检测到。
2. 通过产生向dma缓冲区产生指定频率正弦信号。
3. 通过信号发生器向


项目设计
======

### IO分配


 *               MSP432P401
 *             -----------------
 *            |       P5.1/IO_IN|<---- SW_1 (Switch PWM)
 *            |       P2.7/TA0.4|----> Beep (PWM)
 *            |       P3.5/IO_IN|<---- SW_2 (Switch Sampling rate)
 *            |                 |
 *            |     P1.2/UCA0RXD|<---- PC
 *       RST -|     P1.3/UCA0TXD|----> PC 
 *            |                 |
 *            |            TA3.1|----> PWM (ADC Sampling Clock)
 *            |         P4.3/A10|<---- Mic
 *            |                 |
 *            |                 |

其中SW_1 SW_2 Beep Mic设备由BOOSTXL-EDUMKII（扩展板）提供

###　数据流

MCU : Waves --> Mic --> ADC（DMA） --> MEM Buffer --> FFT --> uart（DMA）

PC  : uart --> Display(Tkinter)


1. 通过ADC从Mic采集数据到数据后送给DMA进行缓存。
2. DMA完成后利用中断唤醒主线程执行FFT运算，存入缓冲区。
3. 接收到上位机请求数据指令。
4. 判断上位机是否要求此次数据，有则通过DMA向PC机发送缓冲区长度数据。

### 技术细节

在进行程序编写方面存在一些问题，现进行一些总结。

__CCS 配置__

- 编译器选用ti的16.04版本编译器。
- 环境问题主要是编译库和静态链接库的配置问题。



